{% extends "base2.html" %}

{% block scripts %}
    
    {% ifequal settings.GEOCAM_AWARE_MAP_BACKEND "earth" %}
        <script src="{{ MEDIA_URL }}external/js/geo-pack.js" type="text/javascript"></script>
        <script src="{{ MEDIA_URL }}external/js/extensions-pack.js" type="text/javascript"></script>
        <script src="http://google.com/jsapi?key={{ settings.GOOGLE_MAPS_API_KEY }}" type="text/javascript"></script>
    {% endifequal %}
    
    {% ifequal settings.GEOCAM_AWARE_MAP_BACKEND "maps" %}
    <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
        {% if settings.USE_MARKER_CLUSTERING %}
            <script src="{{ MEDIA_URL }}external/markerclusterer_compiled.js" type="text/javascript"></script>
        {% endif %}
    {% endifequal %}
    
    <script src="{{ MEDIA_URL }}external/js/jquery.form.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}external/js/timeUtils.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/geocamAware.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Widget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/WidgetManager.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/MapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/StubMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/MapsApiMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/EarthApiMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/GalleryWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/SidebarSwitcher.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/FeatureDetailWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/FeatureEditWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/ajaxForm.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Feature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/PointFeature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/ExtentFeature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Track.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Image.js" type="text/javascript"></script>
    
    <script src="{{ MEDIA_URL }}external/js/usng.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Photo.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/corePatches.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamTrack/js/geocamTrack.js" type="text/javascript"></script>
    
    {% if query %}
        <script src="{{ settings.SCRIPT_NAME }}geocamLens/featuresJson.js?q={{ query|urlencode }}&forceReload={% now "ymdHis" %}" type="text/javascript"></script>
    {% else %}
        <script src="{{ settings.SCRIPT_NAME }}geocamLens/featuresJson.js?forceReload={% now "ymdHis" %}" type="text/javascript"></script>
    {% endif %}
    
{% endblock %}

{% block jsSetVars %}
    geocamAware.settings = {{ exportSettings|safe }};
{% endblock %}

{% block jsInit %}
    geocamAware.viewportG = "{{ viewport }}";
    geocamAware.queryG = "{{ query }}";

    if (geocamAware.GEOCAM_AWARE_MAP_BACKEND == "earth") {
        google.load("earth", "1");
    }

    window.onload = geocamAware.init;
{% endblock %}

{% block contents %}
    <div id="mapwrapper" style="height:100%; width:100%;">
        <div id="mapcontrols">
            <span class="linkButton" onclick="javascript:geocamAware.mapG.zoomToFit()">Zoom to fit</span> -
            <span id="featuresOutOfView"></span>
        </div>
        <div id="mapContainer" style="height:100%; width:100%;"></div>
    </div>
{% endblock %}
