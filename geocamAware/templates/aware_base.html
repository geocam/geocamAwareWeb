{% extends "base2.html" %}

{% block scripts %}
    
    <!-- Map Specific Includes -->
    {% ifequal settings.GEOCAM_AWARE_MAP_BACKEND "earth" %}
        <script src="{{ MEDIA_URL }}external/js/geo-pack.js" type="text/javascript"></script>
        <script src="{{ MEDIA_URL }}external/js/extensions-pack.js" type="text/javascript"></script>
        <script src="http://google.com/jsapi?key={{ settings.GOOGLE_MAPS_API_KEY }}" type="text/javascript"></script>
    {% endifequal %}
    
    <!-- More Map Specific Includes -->
    {% ifequal settings.GEOCAM_AWARE_MAP_BACKEND "maps" %}
    <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
        {% if settings.USE_MARKER_CLUSTERING %}
            <script src="{{ MEDIA_URL }}external/markerclusterer_compiled.js" type="text/javascript"></script>
        {% endif %}
    {% endifequal %}
    
    <!-- Aware Controller -->
    {% block aware %}
    <script src="{{ MEDIA_URL }}geocamAware/js/geocamAware.js" type="text/javascript"></script>
    {% endblock %}
    
    <!-- Aware Required Libraries -->
    <script src="{{ MEDIA_URL }}external/js/jquery.form.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}external/js/timeUtils.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Widget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/WidgetManager.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/MapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/StubMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/MapsApiMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/EarthApiMapViewer.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/GalleryWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/SidebarSwitcher.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/FeatureDetailWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/FeatureEditWidget.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/ajaxForm.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Feature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/PointFeature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/ExtentFeature.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Track.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Image.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}external/js/usng.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/Photo.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamAware/js/corePatches.js" type="text/javascript"></script>
    <script src="{{ MEDIA_URL }}geocamTrack/js/geocamTrack.js" type="text/javascript"></script>
    
    <!-- Aware Data Source -->
    {% if query %}
        <script src="{{ settings.SCRIPT_NAME }}geocamLens/featuresJson.js?q={{ query|urlencode }}&forceReload={% now "ymdHis" %}" type="text/javascript"></script>
    {% else %}
        <script src="{{ settings.SCRIPT_NAME }}geocamLens/featuresJson.js?forceReload={% now "ymdHis" %}" type="text/javascript"></script>
    {% endif %}
    
    <!-- Aware Specific Menu Options -->
    <script type="text/javascript" charset="utf-8">
        
        /* Handles updating the view to display features near the users current location */
        function go_to_current_location() {
            toggle_menu();
            geocamAware.goToCurrentLocation();
        }
        
        /* Displays the search box for going to address */
        function show_address_search_box() {
            toggle_menu();
            $('#address_form').toggle();
        }
    
        /* Handles updating the view to display features near the given address */
        function go_to_address(f) {
            var address = $('#address').val();
            geocamAware.goToAddress(address);
            return false;
        }
        
        /* Resets the address var and form */
        function clear_address() {
            $('#address_form').toggle();
            $('#address').val('Enter Address');
        }
        
        /* Displays the search box for querying features */
        function show_query_search_box() {
            toggle_menu();
            $('#query_form').toggle();
        }
        
        /* Handles the actually querying of features */
        function go_to_query(f) {
            var query = $('#query').val();
            geocamAware.goToQuery(query);
            return false;
        }
        
        /* Resets the query session var and form, returning to the top of the feature set */
        function clear_query() {
            geocamAware.goToQuery(null);
            
            $('#query_form').toggle();
            $('#query').val('Enter Query');
        }
        
        /* Interface to drop pin */
        function drop_pin() {
            toggle_menu();
            geocamAware.dropPin();
        }
        
        toggle_details = function(feature) {
            $('#block').toggle();
            $('#info_panel').toggle();
            $('#featuresOutOfView').toggle();
            
            $('#info_panel_content').text("Hello");
        }
    </script>
{% endblock %}

{% block jsSetVars %}
    geocamAware.settings = {{ exportSettings|safe }};
{% endblock %}

{% block jsInit %}
    geocamAware.viewportG = "{{ viewport }}";
    geocamAware.queryG = "{{ query }}";

    if (geocamAware.GEOCAM_AWARE_MAP_BACKEND == "earth") { google.load("earth", "1"); }

    window.onload = geocamAware.init;
{% endblock %}

{% block contents %}
    {% block controls %}
        <div id="awarecontrols">
            <span id="featuresOutOfView"></span>
            <div id="address_form" style="display:none;">
                <form onsubmit="return go_to_address(this);">
                    <table class="geocam_table" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="90%">
                                <input type="text" name="address" id="address" onfocus="if(this.value == 'Enter Address'){this.value='';}" onblur="if(this.value == ''){this.value='Enter Address';}" value="Enter Address">
                            </td>
                            <td valign="middle">
                                <a href="javascript:void();" onclick="go_to_address();" class="small_awesome_button">Go To</a>
                                <a href="javascript:void();" onclick="clear_address();" class="small_awesome_button">Clear</a>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
            <div id="query_form" {% if query == "" or query == None %}style="display:none;"{% endif %}>
                <form onsubmit="return go_to_query(this);">
                    <table class="geocam_table" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td width="90%">
                                <input type="text" name="query" id="query" onfocus="if(this.value == 'Enter Query'){this.value='';}" onblur="if(this.value == ''){this.value='Enter Query';}" value="{% if query %}{{ query|safe }}{% else %}Enter Query{% endif %}">
                            </td>
                            <td valign="middle">
                                <a href="javascript:void();" onclick="go_to_query();" class="small_awesome_button">Search</a> 
                                <a href="javascript:void();" onclick="clear_query();" class="small_awesome_button">Clear</a>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    {% endblock %}
    
    <div id="block" style="height:100%; width:100%;">
        {% block view %}
        {% endblock %}
    </div>
    
    <div id="info_panel" style="display:none;">
        <div id="info_panel_content"></div>
        <a href="javascript:void();" onclick="toggle_details();" class="big_awesome_button">Back</a>
    </div>
{% endblock %}